
#Note:
# - wu_fetch.v - stop when pc >=50
# -  clock cycle is $time=1000
#
# Make sure to change PEArray/SIMULATION/common/TB_common.vh 
vim   ../../../PEArray/SIMULATION/common/TB_common.vh
#  `define TB_ENABLE_REGFILE_DRIVER
#  `undef  TB_ENABLE_REGFILE_DRIVER
#  - 4-> 64
#vi   ../../../PEArray/HDL/common/pe_array.vh 
sed -i -e 's/64/4/g' ../../../PEArray/HDL/common/pe_array.vh
cp ../../../Manager/scripts/nocConfig_mesh2x2.txt ../../../Manager/scripts/nocConfig.txt
cp ../common/noc_interMgr_port_Bitmasks_2x2.vh ../../../Manager/HDL/common/noc_interMgr_port_Bitmasks.vh
cp inputFiles.2x2/* inputFiles/.
cp configFiles.2x2/* configFiles/.

# restrict number of instructions
#  modified files in tmp/.
cp   tmp/manager_3_layer1_instruction_readmem.dat \
     tmp/manager_2_layer1_instruction_readmem.dat \
     tmp/manager_1_layer1_instruction_readmem.dat \
     tmp/manager_0_layer1_instruction_readmem.dat \
     inputFiles/.

# or edit
gvim inputFiles/manager_3_layer1_instruction_readmem.dat \
     inputFiles/manager_2_layer1_instruction_readmem.dat \
     inputFiles/manager_1_layer1_instruction_readmem.dat \
     inputFiles/manager_0_layer1_instruction_readmem.dat 




# back to 8x8
git checkout ../../../Manager/scripts/nocConfig.txt
git checkout ../../../Manager/HDL/common/noc_interMgr_port_Bitmasks.vh
git checkout ../../../PEArray/HDL/common/pe_array.vh 
cp inputFiles.8x8/* inputFiles/.
cp configFiles.8x8/* configFiles/.

grep ERROR transcript ; grep PASS transcript | wc -l
echo 'Expect 20480'
#20480

grep 'Packet.*sent.*from' transcript  | wc -l ; grep 'Received.*expected packet' transcript  | wc -l
echo 'Expect 395 <cr> 395'
#395
#395


# View instructions
gvim -O inputFiles/manager_0_layer1_{i,d}cntl_readmem.dat inputFiles/manager_0_layer1_option*e{0,1,2}*

sed -i -e 's/mgr_inst\[2\]/mgr_inst\[1\]/' mmc*.do ; sed -i -e 's/MGR2/MGR1/' mmc*.do ; sed -i -e 's/diram_port_arrays\[2\]/diram_port_arrays\[1\]/' mmc*.do
sed -i -e 's/mgr_inst\[2\]/mgr_inst\[1\]/' ram.do ; sed -i -e 's/MGR2/MGR1/' ram.do ; sed -i -e 's/diram_port_arrays\[2\]/diram_port_arrays\[1\]/' ram.do
sed -i -e 's/mgr_inst\[2\]/mgr_inst\[1\]/' debug.do ; sed -i -e 's/MGR2/MGR1/' debug.do ; sed -i -e 's/diram_port_arrays\[2\]/diram_port_arrays\[1\]/' debug.do
sed -i -e 's/mgr_inst\[2\]/mgr_inst\[1\]/' wave.do ; sed -i -e 's/MGR2/MGR1/' wave.do ; sed -i -e 's/diram_port_arrays\[2\]/diram_port_arrays\[1\]/' wave.do
sed -i -e 's/mgr_inst\[1\]/mgr_inst\[2\]/' debug.do ; sed -i -e 's/MGR1/MGR2/' debug.do ; sed -i -e 's/diram_port_arrays\[1\]/diram_port_arrays\[2\]/' debug.do
sed -i -e 's/mgr_inst\[1\]/mgr_inst\[2\]/' wave.do ; sed -i -e 's/MGR1/MGR2/' wave.do ; sed -i -e 's/diram_port_arrays\[1\]/diram_port_arrays\[2\]/' wave.do

sed -i -e 's/mgr_inst\[3\]/mgr_inst\[0\]/' debug.do ; sed -i -e 's/MGR3/MGR0/' debug.do ; sed -i -e 's/diram_port_arrays\[3\]/diram_port_arrays\[0\]/' debug.do
sed -i -e 's/mgr_inst\[2\]/mgr_inst\[0\]/' debug.do ; sed -i -e 's/MGR2/MGR0/' debug.do ; sed -i -e 's/diram_port_arrays\[2\]/diram_port_arrays\[0\]/' debug.do
sed -i -e 's/mgr_inst\[1\]/mgr_inst\[0\]/' debug.do ; sed -i -e 's/MGR1/MGR0/' debug.do ; sed -i -e 's/diram_port_arrays\[1\]/diram_port_arrays\[0\]/' debug.do
sed -i -e 's/mgr_inst\[0\]/mgr_inst\[0\]/' debug.do ; sed -i -e 's/MGR0/MGR0/' debug.do ; sed -i -e 's/diram_port_arrays\[0\]/diram_port_arrays\[0\]/' debug.do

sed -i -e 's/mgr_inst\[3\]/mgr_inst\[1\]/' debug.do ; sed -i -e 's/MGR3/MGR1/' debug.do ; sed -i -e 's/diram_port_arrays\[3\]/diram_port_arrays\[1\]/' debug.do
sed -i -e 's/mgr_inst\[2\]/mgr_inst\[1\]/' debug.do ; sed -i -e 's/MGR2/MGR1/' debug.do ; sed -i -e 's/diram_port_arrays\[2\]/diram_port_arrays\[1\]/' debug.do
sed -i -e 's/mgr_inst\[1\]/mgr_inst\[1\]/' debug.do ; sed -i -e 's/MGR1/MGR1/' debug.do ; sed -i -e 's/diram_port_arrays\[1\]/diram_port_arrays\[1\]/' debug.do
sed -i -e 's/mgr_inst\[0\]/mgr_inst\[1\]/' debug.do ; sed -i -e 's/MGR0/MGR1/' debug.do ; sed -i -e 's/diram_port_arrays\[0\]/diram_port_arrays\[1\]/' debug.do

